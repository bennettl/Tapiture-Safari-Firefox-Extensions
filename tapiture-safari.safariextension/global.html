<!DOCTYPE HTML>
<!-- <script type="text/javascript" src="jquery-1.10.2.min.js"></script> -->
<script type="text/javascript">

safari.application.addEventListener("command", performCommand, false);

safari.application.addEventListener("message", waitForMessage, false);

function waitForMessage(event){
	console.log('wait for message');
	if (event.name = "tapiture_injected_loaded"){
		safari.application.activeBrowserWindow.activeTab.page.dispatchMessage('tapItButtonEnable', safari.extension.settings.tapItButtonEnable);
	}

}


console.log(safari.extension.settings.tapItButtonEnable);

// // Function to perform when 'command event' is received
function performCommand(event) {
	console.log(event.command);
	
	// When user clicks tap this
	if (event.command == "userClickTapThis"){
		var userInfo 	= event.userInfo;
		console.log(userInfo);
		safari.application.activeBrowserWindow.activeTab.page.dispatchMessage('userClickTapThis', userInfo);
	}
}

</script>